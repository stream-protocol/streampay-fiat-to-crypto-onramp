{"ast":null,"code":"import _objectSpread from\"/workspace/streampay-fiat-to-crypto-onramp/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/workspace/streampay-fiat-to-crypto-onramp/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _slicedToArray from\"/workspace/streampay-fiat-to-crypto-onramp/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _excluded=[\"clientSecret\",\"appearance\",\"onReady\",\"onChange\"];import React from'react';// ReactContext to simplify access of StripeOnramp object\nimport{jsx as _jsx}from\"react/jsx-runtime\";var CryptoElementsContext=/*#__PURE__*/React.createContext(null);CryptoElementsContext.displayName='CryptoElementsContext';export var CryptoElements=function CryptoElements(_ref){var stripeOnramp=_ref.stripeOnramp,children=_ref.children;var _React$useState=React.useState(function(){return{onramp:null};}),_React$useState2=_slicedToArray(_React$useState,2),ctx=_React$useState2[0],setContext=_React$useState2[1];React.useEffect(function(){var isMounted=true;Promise.resolve(stripeOnramp).then(function(onramp){if(onramp&&isMounted){setContext(function(ctx){return ctx.onramp?ctx:{onramp:onramp};});}});return function(){isMounted=false;};},[stripeOnramp]);return/*#__PURE__*/_jsx(CryptoElementsContext.Provider,{value:ctx,children:children});};// React hook to get StripeOnramp from context\nexport var useStripeOnramp=function useStripeOnramp(){var context=React.useContext(CryptoElementsContext);return context===null||context===void 0?void 0:context.onramp;};// React element to render Onramp UI\nvar useOnrampSessionListener=function useOnrampSessionListener(type,session,callback){React.useEffect(function(){if(session&&callback){var listener=function listener(e){return callback(e.payload);};session.addEventListener(type,listener);return function(){session.removeEventListener(type,listener);};}return function(){};},[session,callback,type]);};export var OnrampElement=function OnrampElement(_ref2){var clientSecret=_ref2.clientSecret,appearance=_ref2.appearance,onReady=_ref2.onReady,onChange=_ref2.onChange,props=_objectWithoutProperties(_ref2,_excluded);var stripeOnramp=useStripeOnramp();var onrampElementRef=React.useRef(null);var _React$useState3=React.useState(),_React$useState4=_slicedToArray(_React$useState3,2),session=_React$useState4[0],setSession=_React$useState4[1];var appearanceJSON=JSON.stringify(appearance);React.useEffect(function(){var containerRef=onrampElementRef.current;if(containerRef){// NB: ideally we want to be able to hot swap/update onramp iframe\n// This currently results a flash if one needs to mint a new session when they need to udpate fixed transaction details\ncontainerRef.innerHTML='';if(clientSecret&&stripeOnramp){setSession(stripeOnramp.createSession({clientSecret:clientSecret,appearance:appearanceJSON?JSON.parse(appearanceJSON):{}}).mount(containerRef));}}},[appearanceJSON,clientSecret,stripeOnramp]);useOnrampSessionListener('onramp_ui_loaded',session,onReady);useOnrampSessionListener('onramp_session_updated',session,onChange);return/*#__PURE__*/_jsx(\"div\",_objectSpread(_objectSpread({},props),{},{ref:onrampElementRef}));};","map":{"version":3,"names":["React","jsx","_jsx","CryptoElementsContext","createContext","displayName","CryptoElements","_ref","stripeOnramp","children","_React$useState","useState","onramp","_React$useState2","_slicedToArray","ctx","setContext","useEffect","isMounted","Promise","resolve","then","Provider","value","useStripeOnramp","context","useContext","useOnrampSessionListener","type","session","callback","listener","e","payload","addEventListener","removeEventListener","OnrampElement","_ref2","clientSecret","appearance","onReady","onChange","props","_objectWithoutProperties","_excluded","onrampElementRef","useRef","_React$useState3","_React$useState4","setSession","appearanceJSON","JSON","stringify","containerRef","current","innerHTML","createSession","parse","mount","_objectSpread","ref"],"sources":["/workspace/streampay-fiat-to-crypto-onramp/src/StripeCryptoElements.jsx"],"sourcesContent":["import React from 'react';\n\n// ReactContext to simplify access of StripeOnramp object\nconst CryptoElementsContext =\n  React.createContext(null);\nCryptoElementsContext.displayName = 'CryptoElementsContext';\n\nexport const CryptoElements = ({\n  stripeOnramp,\n  children,\n}) => {\n  const [ctx, setContext] = React.useState(() => ({\n    onramp: null,\n  }));\n\n  React.useEffect(() => {\n    let isMounted = true;\n\n    Promise.resolve(stripeOnramp).then((onramp) => {\n      if (onramp && isMounted) {\n        setContext((ctx) => (ctx.onramp ? ctx : { onramp }));\n      }\n    });\n\n    return () => {\n      isMounted = false;\n    };\n  }, [stripeOnramp]);\n\n  return (\n    <CryptoElementsContext.Provider value={ctx}>\n      {children}\n    </CryptoElementsContext.Provider>\n  );\n};\n\n// React hook to get StripeOnramp from context\nexport const useStripeOnramp = () => {\n  const context = React.useContext(CryptoElementsContext);\n  return context?.onramp;\n};\n\n// React element to render Onramp UI\nconst useOnrampSessionListener = (\n  type,\n  session,\n  callback\n) => {\n  React.useEffect(() => {\n    if (session && callback) {\n      const listener = (e) => callback(e.payload);\n      session.addEventListener(type, listener);\n      return () => {\n        session.removeEventListener(type, listener);\n      };\n    }\n    return () => {};\n  }, [session, callback, type]);\n};\n\nexport const OnrampElement = ({\n  clientSecret,\n  appearance,\n  onReady,\n  onChange,\n  ...props\n}) => {\n  const stripeOnramp = useStripeOnramp();\n  const onrampElementRef = React.useRef(null);\n  const [session, setSession] = React.useState();\n\n  const appearanceJSON = JSON.stringify(appearance);\n  React.useEffect(() => {\n    const containerRef = onrampElementRef.current;\n    if (containerRef) {\n      // NB: ideally we want to be able to hot swap/update onramp iframe\n      // This currently results a flash if one needs to mint a new session when they need to udpate fixed transaction details\n      containerRef.innerHTML = '';\n\n      if (clientSecret && stripeOnramp) {\n        setSession(\n          stripeOnramp\n            .createSession({\n              clientSecret,\n              appearance: appearanceJSON ? JSON.parse(appearanceJSON) : {}\n            })\n            .mount(containerRef)\n        );\n      }\n    }\n  }, [appearanceJSON, clientSecret, stripeOnramp]);\n\n  useOnrampSessionListener('onramp_ui_loaded', session, onReady);\n  useOnrampSessionListener('onramp_session_updated', session, onChange);\n\n  return <div {...props} ref={onrampElementRef}></div>;\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}